<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BTD6 Social â€“ Unified Feed</title>
<style>
  body {
    background: #0f111a;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 0;
    height: 100vh;
    display: flex;
    flex-direction: column;
  }

  /* Top navigation */
  #navbar {
    display: flex;
    justify-content: center;
    background: #1a1d2b;
    border-bottom: 2px solid #2c2f40;
  }
  .tab {
    padding: 12px 20px;
    cursor: pointer;
    transition: 0.3s;
    font-weight: bold;
  }
  .tab:hover { background: #2c2f40; }
  .tab.active {
    background: #2c2f40;
    border-bottom: 3px solid #ff5252;
  }

  /* Main container */
  #main {
    flex: 1;
    display: flex;
    overflow: hidden;
  }
  #sidebar {
    width: 240px;
    background: #1a1d2b;
    border-right: 2px solid #2c2f40;
    padding: 10px;
    overflow-y: auto;
  }
  #content {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: #181a27;
  }
  #header {
    background: #1e2032;
    padding: 10px;
    border-bottom: 2px solid #2c2f40;
    font-weight: bold;
  }
  #view {
    flex: 1;
    padding: 10px;
    overflow-y: auto;
  }
  .item {
    padding: 8px;
    border-radius: 6px;
    background: #23263a;
    margin-bottom: 4px;
    cursor: pointer;
    transition: 0.2s;
  }
  .item:hover { background: #2d3150; }
  .item.unread {
    color: #ff4747;
    font-weight: bold;
  }
  .msg, .post {
    background: #25283d;
    padding: 8px;
    border-radius: 6px;
    margin-bottom: 6px;
    max-width: 80%;
  }
  .msg.self, .post.self {
    background: #2b3460;
    margin-left: auto;
  }
  #inputArea {
    display: flex;
    border-top: 2px solid #2c2f40;
  }
  #inputArea input {
    flex: 1;
    padding: 10px;
    border: none;
    outline: none;
    background: #202338;
    color: #fff;
  }
  #inputArea button {
    background: #3a3f70;
    border: none;
    color: white;
    padding: 10px 16px;
    cursor: pointer;
  }
  #inputArea button:hover { background: #5056a5; }
</style>
</head>
<body>

<!-- Top navigation -->
<div id="navbar">
  <div class="tab active" data-tab="feed">Feed</div>
  <div class="tab" data-tab="threads">Threads</div>
  <div class="tab" data-tab="dms">Messages</div>
</div>

<!-- Main area -->
<div id="main">
  <div id="sidebar">
    <div id="feedList" class="tabContent">
      <h3>Latest Posts</h3>
      <ul id="feedItems"></ul>
    </div>

    <div id="threadListWrap" class="tabContent" style="display:none;">
      <h3>Threads</h3>
      <ul id="threadList"></ul>
      <button id="newThreadBtn" style="width:100%;margin-top:5px;">âž• New Thread</button>
    </div>

    <div id="dmListWrap" class="tabContent" style="display:none;">
      <h3>Direct Messages</h3>
      <ul id="dmList"></ul>
    </div>
  </div>

  <div id="content">
    <div id="header">Welcome to BTD6 Social</div>
    <div id="view"></div>
    <div id="inputArea">
      <input id="inputBox" placeholder="Type a message..." disabled>
      <button id="sendBtn" disabled>Send</button>
    </div>
  </div>
</div>

<script>
/* ------------------------------
   Shared State
------------------------------ */
let activeTab = "feed";
let activeType = null;  // 'feed' | 'thread' | 'dm'
let activeTarget = null;
const unread = new Set();

/* ------------------------------
   Tab System
------------------------------ */
document.querySelectorAll(".tab").forEach(tab => {
  tab.addEventListener("click", () => switchTab(tab.dataset.tab));
});
function switchTab(tabName) {
  activeTab = tabName;
  document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
  document.querySelector(`.tab[data-tab='${tabName}']`).classList.add("active");
  document.querySelectorAll(".tabContent").forEach(div => div.style.display = "none");

  if (tabName === "feed") document.getElementById("feedList").style.display = "block";
  if (tabName === "threads") document.getElementById("threadListWrap").style.display = "block";
  if (tabName === "dms") document.getElementById("dmListWrap").style.display = "block";

  clearView();
}

/* ------------------------------
   Unread Helpers
------------------------------ */
function markUnread(id, selector) {
  const el = document.querySelector(`${selector} [data-id="${id}"]`);
  if (el && !el.classList.contains("unread")) {
    el.classList.add("unread");
    el.textContent = el.textContent.replace(" ðŸ”´", "") + " ðŸ”´";
    unread.add(id);
  }
}
function clearUnread(id, selector) {
  const el = document.querySelector(`${selector} [data-id="${id}"]`);
  if (el && el.classList.contains("unread")) {
    el.classList.remove("unread");
    el.textContent = el.textContent.replace(" ðŸ”´", "");
    unread.delete(id);
  }
}

/* ------------------------------
   FEED LOGIC
------------------------------ */
function loadFeed() {
  const posts = [
    { id: "f1", title: "Welcome to BTD6 Social!", body: "Introduce yourself here." },
    { id: "f2", title: "New Event!", body: "Boss Bloon incoming this weekend!" }
  ];
  const list = document.getElementById("feedItems");
  list.innerHTML = "";
  posts.forEach(p => {
    const li = document.createElement("li");
    li.className = "item";
    li.dataset.id = p.id;
    li.textContent = p.title;
    li.onclick = () => openFeed(p);
    list.appendChild(li);
  });
}
function openFeed(post) {
  activeType = "feed";
  activeTarget = post.id;
  clearUnread(post.id, "#feedItems");
  setHeader(post.title);
  const view = document.getElementById("view");
  view.innerHTML = `<div class="post">${post.body}</div>`;
  disableInput(); // read-only
}

/* ------------------------------
   THREAD LOGIC
------------------------------ */
function loadThreads() {
  const threads = [
    { id: "t1", title: "Favorite Hero?", messages: ["I like Quincy!", "Adora all the way!"] },
    { id: "t2", title: "Best Map?", messages: ["Logs is chill.", "Cubism easy!"] }
  ];
  const list = document.getElementById("threadList");
  list.innerHTML = "";
  threads.forEach(t => {
    const li = document.createElement("li");
    li.className = "item";
    li.dataset.id = t.id;
    li.textContent = t.title;
    li.onclick = () => openThread(t);
    list.appendChild(li);
  });
}
function createThread(title) {
  const list = document.getElementById("threadList");
  const id = "t" + Date.now();
  const li = document.createElement("li");
  li.className = "item";
  li.dataset.id = id;
  li.textContent = title;
  li.onclick = () => openThread({ id, title, messages: [] });
  list.appendChild(li);
}
function openThread(thread) {
  activeType = "thread";
  activeTarget = thread.id;
  clearUnread(thread.id, "#threadList");
  setHeader("Thread: " + thread.title);
  const view = document.getElementById("view");
  view.innerHTML = "";
  thread.messages.forEach(m => appendPost(m));
  enableInput();
}
function replyThread(text) {
  if (activeType !== "thread") return;
  appendPost("You: " + text, true);
}
function appendPost(text, self = false) {
  const div = document.createElement("div");
  div.className = "post" + (self ? " self" : "");
  div.textContent = text;
  document.getElementById("view").appendChild(div);
}

/* ------------------------------
   DM LOGIC
------------------------------ */
function loadDMList() {
  const users = ["MonkeyFan", "BananaLord", "SuperDart"];
  const list = document.getElementById("dmList");
  list.innerHTML = "";
  users.forEach(u => {
    const li = document.createElement("li");
    li.className = "item";
    li.dataset.id = u;
    li.textContent = u;
    li.onclick = () => openDM(u);
    list.appendChild(li);
  });
}
function openDM(username) {
  activeType = "dm";
  activeTarget = username;
  clearUnread(username, "#dmList");
  setHeader("DM with " + username);
  document.getElementById("view").innerHTML = "";
  enableInput();
}
function sendDM(text) {
  if (activeType !== "dm") return;
  appendMessage("You", text, true);
  setTimeout(() => receiveDM(activeTarget, "Auto-reply from " + activeTarget), 1000);
}
function appendMessage(sender, text, self = false) {
  const div = document.createElement("div");
  div.className = "msg" + (self ? " self" : "");
  div.textContent = sender + ": " + text;
  const view = document.getElementById("view");
  view.appendChild(div);
  view.scrollTop = view.scrollHeight;
}

/* ------------------------------
   Input + Header Helpers
------------------------------ */
function setHeader(txt) { document.getElementById("header").textContent = txt; }
function clearView() {
  setHeader("Welcome to BTD6 Social");
  document.getElementById("view").innerHTML = "";
  disableInput();
}
function enableInput() {
  document.getElementById("inputBox").disabled = false;
  document.getElementById("sendBtn").disabled = false;
}
function disableInput() {
  document.getElementById("inputBox").disabled = true;
  document.getElementById("sendBtn").disabled = true;
}
document.getElementById("sendBtn").onclick = handleSend;
document.getElementById("inputBox").onkeydown = e => { if (e.key === "Enter") handleSend(); };
function handleSend() {
  const val = document.getElementById("inputBox").value.trim();
  if (!val) return;
  if (activeType === "dm") sendDM(val);
  if (activeType === "thread") replyThread(val);
  document.getElementById("inputBox").value = "";
}

/* ------------------------------
   Fake Incoming Simulation
------------------------------ */
function receiveDM(from, text) {
  if (activeType !== "dm" || activeTarget !== from) {
    markUnread(from, "#dmList");
  } else appendMessage(from, text);
}
function receiveThreadReply(id, text) {
  if (activeType !== "thread" || activeTarget !== id) {
    markUnread(id, "#threadList");
  } else appendPost(text);
}
setInterval(() => {
  const dm = ["MonkeyFan", "BananaLord", "SuperDart"][Math.floor(Math.random()*3)];
  receiveDM(dm, "Hey from " + dm);
}, 10000);
setInterval(() => {
  const t = ["t1", "t2"][Math.floor(Math.random()*2)];
  receiveThreadReply(t, "New reply in " + t);
}, 13000);

/* ------------------------------
   Init
------------------------------ */
loadFeed();
loadThreads();
loadDMList();
document.getElementById("newThreadBtn").onclick = () => {
  const t = prompt("Thread title:");
  if (t) createThread(t);
};
</script>
</body>
</html>
